# 修复页面切换"闪现"问题

## 问题分析

### 🐛 问题描述
在游戏主界面切换页面时，出现了"主界面闪现"的问题：
1. 先播放主界面的淡入淡出动画
2. 再播放目标页面的淡入旋转动画
3. 造成页面闪现，过渡不流畅

### 🔍 问题根源
**双重动画冲突**：
1. **全局覆盖层动画**：`GlobalLoadingOverlay` 的淡入淡出（1s）
2. **页面组件动画**：`PageTransition` 的进入动画（0.6s）
3. **时序错误**：两个动画时机重叠，造成视觉冲突

**原始流程问题**：
```
用户点击 → 显示覆盖层(淡入1s) → 500ms后导航 → 新页面开始渲染 → PageTransition进入动画 → 500ms后隐藏覆盖层(淡出1s)
```

这导致了：
- 覆盖层淡入 + 页面淡出 = 双重淡入效果
- 覆盖层淡出 + 新页面淡入 = 闪现效果

## 解决方案

### ⚡ 优化策略
1. **减少全局覆盖层动画时间**
2. **调整页面过渡时序**
3. **优化PageTransition延迟**

### 🔧 具体修改

#### 1. 更新页面过渡钩子 (`usePageTransition.ts`)
```typescript
const navigateWithTransition = async (path: string, message?: string) => {
  // 立即显示覆盖层
  if (message) {
    showLoading(message, 'transition');
  }

  // 很短延迟后立即导航
  setTimeout(() => {
    navigate(path);
    startExiting(); // 导航后立即开始退出动画
  }, 100); // 只需100ms让覆盖层显示

  // 总过渡时间
  setTimeout(() => {
    hideLoading();
  }, 900); // 总时间900ms
};
```

**关键改进**：
- 减少导航前延迟：`500ms → 100ms`
- 导航后立即开始退出动画
- 总过渡时间控制在900ms

#### 2. 优化全局覆盖层动画 (`GlobalLoadingOverlay.css`)
```css
.global-loading-overlay {
  animation: globalFadeIn 0.3s ease-in-out; /* 1s → 0.3s */
}

.global-loading-overlay.exiting {
  animation: globalFadeOut 0.8s ease-in-out forwards; /* 1s → 0.8s */
}
```

**关键改进**：
- 淡入时间：`1s → 0.3s`（更快显示）
- 淡出时间：`1s → 0.8s`（与新页面动画协调）

#### 3. 调整页面进入动画 (`PageTransition.tsx`)
```typescript
useEffect(() => {
  const timer = setTimeout(() => {
    setIsVisible(true);
  }, 50); // 100ms → 50ms
}, []);
```

**关键改进**：
- 减少延迟：`100ms → 50ms`
- 让页面更快开始进入动画

### 📊 新的时序流程

```
用户点击
    ↓
显示覆盖层(0.3s淡入)
    ↓ 100ms
页面导航 + 开始退出动画
    ↓ 50ms  
新页面开始进入动画
    ↓ 750ms
隐藏覆盖层(已淡出)
```

**时间轴**：
- `0ms`: 显示覆盖层，开始淡入
- `100ms`: 页面导航，开始覆盖层淡出
- `150ms`: 新页面开始进入动画
- `900ms`: 完全隐藏覆盖层

## 效果对比

### 🔴 修复前
- 双重淡入/淡出效果
- 页面闪现问题
- 过渡时间过长（2s+）
- 视觉不连贯

### 🟢 修复后  
- 单一流畅过渡
- 无闪现效果
- 合理过渡时间（0.9s）
- 视觉连贯统一

## 技术优势

### 🎯 用户体验
1. **更流畅**：消除了双重动画冲突
2. **更快速**：减少了总过渡时间
3. **更自然**：单一的过渡流程
4. **更一致**：所有页面切换体验统一

### 🛠️ 技术实现
1. **时序优化**：精确控制动画时机
2. **性能提升**：减少不必要的动画重叠
3. **可维护性**：简化了过渡逻辑
4. **扩展性**：易于调整和优化

## 测试建议

### 📱 测试场景
1. **主页 → 战斗页面**
2. **主页 → 卡牌页面**  
3. **主页 → 祈愿页面**
4. **各页面返回主页**

### 🔍 检查要点
- [ ] 无页面闪现
- [ ] 过渡流畅自然
- [ ] 时间合理（约0.9s）
- [ ] 所有动画协调一致
- [ ] 不同设备性能表现

## 总结

通过精确调整动画时序和减少冗余动画，成功解决了页面切换时的"闪现"问题。新的实现提供了更流畅、更快速、更一致的用户体验。
